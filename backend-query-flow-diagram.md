# Backend Query Flow Diagram: GET /products/{id}

## Complete Request/Response Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           USER / CLIENT APPLICATION                              â”‚
â”‚                                                                                  â”‚
â”‚  curl http://localhost:8080/products/bb3cf35e-8f15-4d33-ae84-222322f1fcd5       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚ HTTP GET Request
                                       â–¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                        SPRING BOOT APPLICATION (Port 8080)                      â”ƒ
â”ƒâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”ƒ
â”ƒ                                                                                 â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”ƒ
â”ƒ  â”‚ LAYER 1: API / ADAPTERS (Outermost Circle)                            â”‚     â”ƒ
â”ƒ  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”ƒ
â”ƒ  â”‚ â”‚ ProductController.java:60-70                                     â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚                                                                  â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚  @GetMapping("/{id}")                                            â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚  public ResponseEntity<ProductDetailQuery>                       â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚      getProductById(@PathVariable UUID id) {                     â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚                                                                  â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚    [1] Extract UUID from path: id                                â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚    [2] Call: getProductByIdQueryHandler.handle(id)               â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚    [3] Return: ResponseEntity.ok(queryResult)                    â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚  }                                                               â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”ƒ
â”ƒ  â”‚  Role: HTTP Protocol Adapter - Parse request, return JSON response    â”‚     â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”ƒ
â”ƒ                                      â”‚                                          â”ƒ
â”ƒ                                      â–¼                                          â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”ƒ
â”ƒ  â”‚ LAYER 2: APPLICATION / USE CASES (CQRS Query Side)                    â”‚     â”ƒ
â”ƒ  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”ƒ
â”ƒ  â”‚ â”‚ GetProductByIdQueryHandler.java:21-31                           â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚                                                                  â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚  @Cacheable(value = "products", key = "#id")                    â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚  public ProductDetailQuery handle(UUID id) {                    â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚                                                                  â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”ƒ
â”ƒ  â”‚                                                                         â”‚     â”ƒ
â”ƒ  â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€ SPRING AOP INTERCEPTS HERE â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚     â”ƒ
â”ƒ  â”‚                  â”‚                                             â”‚        â”‚     â”ƒ
â”ƒ  â”‚                  â–¼                                             â”‚        â”‚     â”ƒ
â”ƒ  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚        â”‚     â”ƒ
â”ƒ  â”‚         â”‚  CACHE CHECK       â”‚                                â”‚        â”‚     â”ƒ
â”ƒ  â”‚         â”‚  Redis Lookup:     â”‚                                â”‚        â”‚     â”ƒ
â”ƒ  â”‚         â”‚  Key: "products::  â”‚                                â”‚        â”‚     â”ƒ
â”ƒ  â”‚         â”‚   bb3cf35e..."     â”‚                                â”‚        â”‚     â”ƒ
â”ƒ  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚        â”‚     â”ƒ
â”ƒ  â”‚                  â”‚                                             â”‚        â”‚     â”ƒ
â”ƒ  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚        â”‚     â”ƒ
â”ƒ  â”‚         â”‚                 â”‚                                   â”‚        â”‚     â”ƒ
â”ƒ  â”‚   CACHE HIT?        CACHE MISS?                               â”‚        â”‚     â”ƒ
â”ƒ  â”‚         â”‚                 â”‚                                   â”‚        â”‚     â”ƒ
â”ƒ  â”‚         â–¼                 â–¼                                   â”‚        â”‚     â”ƒ
â”ƒ  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚        â”‚     â”ƒ
â”ƒ  â”‚  â”‚ RETURN DTO   â”‚  â”‚ Continue to Repository Layer        â”‚   â”‚        â”‚     â”ƒ
â”ƒ  â”‚  â”‚ from Redis   â”‚  â”‚                                     â”‚   â”‚        â”‚     â”ƒ
â”ƒ  â”‚  â”‚              â”‚  â”‚  Product product =                  â”‚   â”‚        â”‚     â”ƒ
â”ƒ  â”‚  â”‚ âš¡ ~5-20ms   â”‚  â”‚    productRepository.findById(id)   â”‚   â”‚        â”‚     â”ƒ
â”ƒ  â”‚  â”‚              â”‚  â”‚      .orElseThrow(...)              â”‚   â”‚        â”‚     â”ƒ
â”ƒ  â”‚  â”‚ Skip steps   â”‚  â”‚                                     â”‚   â”‚        â”‚     â”ƒ
â”ƒ  â”‚  â”‚ 3-7 below!   â”‚  â”‚  return new ProductDetailQuery(...) â”‚   â”‚        â”‚     â”ƒ
â”ƒ  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚        â”‚     â”ƒ
â”ƒ  â”‚         â”‚                            â”‚                       â”‚        â”‚     â”ƒ
â”ƒ  â”‚         â”‚                            â–¼                       â”‚        â”‚     â”ƒ
â”ƒ  â”‚         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚        â”‚     â”ƒ
â”ƒ  â”‚         â”‚         â”‚ STEP 3: Domain Repository Contract  â”‚   â”‚        â”‚     â”ƒ
â”ƒ  â”‚         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚        â”‚     â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚     â”ƒ
â”ƒ            â”‚                            â”‚                                â”‚     â”ƒ
â”ƒ            â”‚                            â–¼                                â”‚     â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚     â”ƒ
â”ƒ  â”‚ LAYER 3:â”‚DOMAIN CORE (Business Rules - Framework Independent)   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚  ProductRepository.java:9                          â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚                                                    â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚  public interface ProductRepository {             â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚      Optional<Product> findById(UUID id);         â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚  }                                                 â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚                                                    â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚  Contract Definition (No Implementation!)         â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚     â”ƒ
â”ƒ  â”‚         â”‚                                                        â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚  Product.java:18-46 (Aggregate Root)              â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚                                                    â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚  @Entity                                           â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚  public class Product {                            â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚    private final UUID id;        // Immutable      â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚    private final String name;    // Immutable      â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚    private final BigDecimal price; // Immutable    â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚                                                    â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚    // Constructor enforces business rules         â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚    public Product(...) {                          â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚      if (price <= 0) throw Exception;             â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚      if (name.isEmpty()) throw Exception;         â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚    }                                              â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â”‚       â”‚  }                                                â”‚   â”‚    â”‚     â”ƒ
â”ƒ  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚     â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚     â”ƒ
â”ƒ            â”‚                                                            â”‚     â”ƒ
â”ƒ            â”‚                                                            â”‚     â”ƒ
â”ƒ            â”‚                                                            â”‚     â”ƒ
â”ƒ  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”ƒ
â”ƒ  â”‚ LAYER 4:â”‚INFRASTRUCTURE / ADAPTERS (Technology Details)         â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚ JpaProductRepository.java:14                              â”‚   â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚                                                            â”‚   â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚  @Repository                                              â”‚   â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚  public interface JpaProductRepository                    â”‚   â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚      extends JpaRepository<Product, UUID>,                â”‚   â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚              ProductRepository {  â† Implements contract   â”‚   â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚  }                                                         â”‚   â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚                                                            â”‚   â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚  Spring Data JPA AUTO-GENERATES:                          â”‚   â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚  SELECT p.id, p.name, p.price                             â”‚   â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚  FROM products p                                          â”‚   â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â”‚  WHERE p.id = ?                                           â”‚   â”‚   â”‚     â”ƒ
â”ƒ  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚     â”ƒ
â”ƒ  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”ƒ
â”ƒ            â”‚                                                            â”‚     â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”¿â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
             â”‚ JDBC Connection
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EXTERNAL SYSTEMS                                                      â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   REDIS CACHE           â”‚      â”‚   POSTGRESQL DATABASE        â”‚    â”‚
â”‚  â”‚   Port: 6379            â”‚      â”‚   Port: 5432                 â”‚    â”‚
â”‚  â”‚                         â”‚      â”‚   Database: catalog_db       â”‚    â”‚
â”‚  â”‚  Key-Value Store:       â”‚      â”‚                              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚      â”‚  Table: products             â”‚    â”‚
â”‚  â”‚  â”‚ products::       â”‚   â”‚      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚  bb3cf35e...     â”‚   â”‚      â”‚  â”‚ id    | UUID (PK)      â”‚  â”‚    â”‚
â”‚  â”‚  â”‚                  â”‚   â”‚      â”‚  â”‚ name  | VARCHAR        â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ Serialized DTO:  â”‚   â”‚      â”‚  â”‚ price | NUMERIC(19,2)  â”‚  â”‚    â”‚
â”‚  â”‚  â”‚ {                â”‚   â”‚      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚  â”‚  id: "bb3cf...", â”‚   â”‚      â”‚                              â”‚    â”‚
â”‚  â”‚  â”‚  name: "...",    â”‚   â”‚      â”‚  Row Data:                   â”‚    â”‚
â”‚  â”‚  â”‚  price: 123.45   â”‚   â”‚      â”‚  bb3cf... | Notebook | 4300 â”‚    â”‚
â”‚  â”‚  â”‚ }                â”‚   â”‚      â”‚                              â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚      â”‚                              â”‚    â”‚
â”‚  â”‚                         â”‚      â”‚                              â”‚    â”‚
â”‚  â”‚  âš¡ In-Memory          â”‚      â”‚  ğŸ’¾ Persistent Storage       â”‚    â”‚
â”‚  â”‚  âš¡ Ultra Fast         â”‚      â”‚  ğŸ”’ ACID Transactions        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â–²                                    â–²                       â”‚
â”‚           â”‚                                    â”‚                       â”‚
â”‚      [CACHE HIT]                          [CACHE MISS]                â”‚
â”‚      Returns in ~5ms                      Query in ~50-200ms          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                    â”‚
            â”‚        RESPONSE FLOW BACKWARDS     â”‚
            â”‚                                    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  STEP 6: Entity Hydration          â”‚
            â”‚  Hibernate maps DB row â†’ Product   â”‚
            â”‚  - Validates business rules        â”‚
            â”‚  - Creates immutable object        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  STEP 7: DTO Mapping               â”‚
            â”‚  Product â†’ ProductDetailQuery      â”‚
            â”‚  new ProductDetailQuery(           â”‚
            â”‚    product.getId(),                â”‚
            â”‚    product.getName(),              â”‚
            â”‚    product.getPrice()              â”‚
            â”‚  )                                 â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  STEP 8: Cache Storage             â”‚
            â”‚  Spring stores DTO in Redis        â”‚
            â”‚  Key: products::bb3cf35e...        â”‚
            â”‚  (For next request)                â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  STEP 9: Return to Controller      â”‚
            â”‚  Handler returns ProductDetailQueryâ”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  STEP 10: HTTP Response            â”‚
            â”‚  ResponseEntity.ok(queryResult)    â”‚
            â”‚                                    â”‚
            â”‚  Status: 200 OK                    â”‚
            â”‚  Content-Type: application/json    â”‚
            â”‚  Body: {                           â”‚
            â”‚    "id": "bb3cf35e...",            â”‚
            â”‚    "name": "Notebook Ultra",       â”‚
            â”‚    "price": 4300.00                â”‚
            â”‚  }                                 â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           USER / CLIENT APPLICATION                     â”‚
â”‚                                                                        â”‚
â”‚  Receives JSON Response                                               â”‚
â”‚  âœ“ Total Time (Cache Hit): ~5-20ms                                    â”‚
â”‚  âœ“ Total Time (Cache Miss): ~50-200ms                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Clean Architecture Layers (Dependency Flow)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DEPENDENCY RULE:                          â”‚
â”‚              All dependencies point INWARD â†’                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   Outer Layer                                          Inner Layer
   (Details)                                            (Business Logic)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Layer  â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Application  â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Domain     â”‚
â”‚              â”‚        â”‚   Layer      â”‚        â”‚    Core      â”‚
â”‚ Controllers  â”‚        â”‚   Handlers   â”‚        â”‚              â”‚
â”‚ HTTP/REST    â”‚        â”‚   Use Cases  â”‚        â”‚  Entities    â”‚
â”‚              â”‚        â”‚   CQRS       â”‚        â”‚  Repository  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  Interfaces  â”‚
                                                â”‚  Business    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚  Rules       â”‚
â”‚Infrastructureâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚
â”‚              â”‚        implements              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ JPA Repos    â”‚        ProductRepository              â–²
â”‚ Redis Config â”‚        interface                      â”‚
â”‚ DB Adapters  â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
                                              Zero dependencies
                                              to outer layers!
```

---

## CQRS Pattern Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CQRS SEPARATION                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    COMMAND SIDE (Write)              QUERY SIDE (Read)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    POST /products                    GET /products/{id}
         â”‚                                  â”‚
         â–¼                                  â–¼
 CreateProductCommandHandler    GetProductByIdQueryHandler
         â”‚                                  â”‚
         â”œâ”€ Validate                        â”œâ”€ Check Cache (Redis)
         â”œâ”€ Create Entity                   â”œâ”€ Fetch from DB
         â”œâ”€ Save to DB                      â”œâ”€ Map to DTO
         â””â”€ Evict Cache â”€â”€â”€â”€â”€â”€â”             â””â”€ Cache Result
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  SHARED: Domain â”‚
                    â”‚  - Product      â”‚
                    â”‚  - Repository   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Different Models, Same Data Source
Optimized Independently
```

---

## Cache Strategy: Look-Aside (Lazy Loading)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LOOK-ASIDE CACHE PATTERN                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Request arrives
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Check    â”‚
â”‚   Cache     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”
   â”‚        â”‚
FOUND    NOT FOUND
   â”‚        â”‚
   â”‚        â–¼
   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   â”‚ 2. Query DB â”‚
   â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
   â”‚          â”‚
   â”‚          â–¼
   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   â”‚ 3. Store in â”‚
   â”‚   â”‚   Cache     â”‚
   â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
   â”‚          â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Return   â”‚
â”‚   to User   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Write Operation:
POST /products
      â”‚
      â–¼
Save to DB
      â”‚
      â–¼
Evict Cache (@CacheEvict)
(Force fresh read on next GET)
```

---

## Technology Stack Mapping

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      TECHNOLOGY LAYERS                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer               Technology              File Location
â”€â”€â”€â”€â”€               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Web/HTTP           Spring Web MVC          ProductController.java
                   Jackson (JSON)          (Auto serialization)

Caching            Spring Cache            @Cacheable annotation
                   Spring Data Redis       application.yaml
                   Redis 7                 docker-compose.yml

Application        Spring Service          GetProductByIdQueryHandler
                   Custom Handlers         @Service beans

Domain             Pure Java POJOs         Product.java
                   No Framework!           ProductRepository.java

Persistence        Spring Data JPA         JpaProductRepository.java
                   Hibernate ORM           @Entity, @Repository
                   PostgreSQL Driver       application.yaml

Observability      Spring Actuator         /health, /metrics
                   Logback JSON            Structured logging

Documentation      SpringDoc OpenAPI       OpenApiConfig.java
                   Swagger UI              /swagger-ui.html
```

---

## Performance Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PERFORMANCE METRICS                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario 1: CACHE HIT (Redis)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Request â†’ Controller â†’ Handler â†’ Redis âœ“ â†’ Response
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  ~5-20ms  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Steps executed: 3
Database queries: 0
Network calls: 1 (Redis local)


Scenario 2: CACHE MISS (Database)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Request â†’ Controller â†’ Handler â†’ Redis âœ— â†’ Repository â†’ PostgreSQL
                                         â†“
                                    Entity Hydration
                                         â†“
                                    DTO Mapping
                                         â†“
                                    Cache Store
                                         â†“
                                    Response
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  ~50-200ms  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Steps executed: 10
Database queries: 1 (SELECT)
Network calls: 2 (Redis check + store, PostgreSQL query)


Improvement: Cache reduces latency by ~90% (10-40x faster)
```

---

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    EXCEPTION HANDLING                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Product Not Found (404):
    Repository.findById() returns Optional.empty()
         â”‚
         â–¼
    .orElseThrow(() -> new RuntimeException("Product not Found"))
         â”‚
         â–¼
    RuntimeException bubbles up
         â”‚
         â–¼
    Spring returns 500 Internal Server Error
    (Should be 404 - improvement needed!)


Domain Validation Error (400):
    Product constructor validation fails
         â”‚
         â–¼
    throws DomainValidationException("Price must be > 0")
         â”‚
         â–¼
    Caught by Spring @ControllerAdvice (if configured)
         â”‚
         â–¼
    Returns 400 Bad Request


Database Connection Error (503):
    PostgreSQL unreachable
         â”‚
         â–¼
    JPA throws DataAccessException
         â”‚
         â–¼
    Spring returns 500 Internal Server Error


Redis Connection Error (Graceful):
    Redis unreachable
         â”‚
         â–¼
    Spring Cache catches exception
         â”‚
         â–¼
    Falls back to Database query (transparent to user)
```

---

## File Reference Map

```
Request Flow                     File Path
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. HTTP Request                 â†’ api/controller/ProductController.java:67
2. Query Handler                â†’ application/query/handler/GetProductByIdQueryHandler.java:22
3. Cache Check                  â†’ Spring AOP (@Cacheable annotation)
4. Repository Interface         â†’ domain/repository/ProductRepository.java:9
5. JPA Implementation           â†’ infrastructure/repository/JpaProductRepository.java:14
6. Domain Entity                â†’ domain/entity/Product.java:18
7. DTO Response                 â†’ application/query/dto/ProductDetailQuery.java:7
8. Configuration                â†’ src/main/resources/application.yaml:27-28

External Systems:
- Redis Config                  â†’ docker-compose.yml:19-23
- PostgreSQL Config             â†’ docker-compose.yml:8-17
- Kubernetes Deployment         â†’ k8s/01-app-deployment.yaml
- CI/CD Pipeline                â†’ .github/workflows/main.yml
```

---

## Summary

This diagram illustrates a production-grade implementation of:
- **Clean Architecture** (layered, dependency inversion)
- **CQRS** (separate query handlers)
- **DDD** (domain entities with business rules)
- **Distributed Caching** (Redis look-aside pattern)
- **Spring Boot** (dependency injection, AOP, data access)

The flow demonstrates both high performance (cache hits) and data consistency (cache misses with DB fallback).
